--REVIEW LEVEL PER STATE IN CANADA
SELECT COUNTRY, STATE, AVG(RATING) AS AVG_REVIEW_STATE
FROM JOBS_ALL 
GROUP BY COUNTRY, STATE
HAVING AVG(RATING) > 0.1
AND COUNT(*) > 10 -- SO NULL VALUES AND OUTLIERS ARE EXCLUDED
AND COUNTRY = 'Canada' 
ORDER BY AVG_REVIEW_STATE DESC;

--REVIEW LEVEL PER STATE IN USA
SELECT COUNTRY, STATE, AVG(RATING) AS AVG_REVIEW_STATE
FROM JOBS_ALL 
GROUP BY COUNTRY, STATE
HAVING AVG(RATING) > 0.1
AND COUNT(*) > 10 -- SO NULL VALUES AND OUTLIERS ARE EXCLUDED
AND COUNTRY = 'USA' 
ORDER BY AVG_REVIEW_STATE DESC;


--REVIEW LEVEL PER CITY IN CANADA
SELECT CITY, AVG(RATING) AS AVG_REVIEW_CITY
FROM JOBS_CANADA 
GROUP BY COUNTRY, CITY
HAVING AVG(RATING) > 0.1 -- SO NULL VALUES ARE EXCLUDED
AND COUNTRY = 'Canada'
ORDER BY AVG_REVIEW_CITY DESC;

--REVIEW LEVEL PER CITY IN THE US
SELECT COUNTRY, CITY, AVG(RATING) AS AVG_REVIEW_CITY
FROM JOBS_ALL 
GROUP BY COUNTRY, CITY
HAVING AVG(RATING) > 0.1 -- SO NULL VALUES ARE EXCLUDED
AND COUNTRY = 'USA'
ORDER BY AVG_REVIEW_CITY DESC;

--CONCLUSION
--USA: NC, CA, IL HAVE THE MOST HIGHLY RATED JOBS, HAVING 4.5, 4 AND 4 ON AVERAGE RESPECTIVELY;
--PARTICULARLY CHARLOTTE, FAIR OAKS AND CALIFORNIA ARE THE CITIES WHERE THE BEST REVIEWED JOBS ARE LOCATED

--CANADA:  BC, ON, QC HAVE THE MOST HIGHLY RATED JOBS, BUT AVG_REVIEW IS PRETTY LOW, COMPARING WITH THE US;
--PARTICULARLY QUEBEC CITY, SASKATOON AND LA RONGE ARE THE CITIES WHERE THE BEST REVIEWED JOBS ARE LOCATED


-----------------------------------------------------------------------------------------------------------------------------------------------------------------------




--AMOUNT OF JOBS PER STATE 
SELECT COUNTRY, STATE, COUNT(*) AS NUM_JOBS_STATE
FROM JOBS_ALL 
GROUP BY COUNTRY, STATE
HAVING STATE IS NOT NULL
--HAVING AVG(RATING) > 0.1 -- SO NULL VALUES ARE EXCLUDED
ORDER BY NUM_JOBS_STATE DESC;

--AMOUNT OF JOBS PER CITY 
SELECT COUNTRY, CITY, COUNT(*) AS NUM_JOBS_CITY
FROM JOBS_ALL 
GROUP BY COUNTRY, CITY
HAVING CITY IS NOT NULL
--HAVING AVG(RATING) > 0.1 -- SO NULL VALUES ARE EXCLUDED
ORDER BY NUM_JOBS_CITY DESC;

--AMOUNT OF JOBS PER INDUSTRY
SELECT COUNTRY, INDUSTRY, COUNT(*) AS NUM_JOBS_IND
FROM JOBS_ALL 
GROUP BY COUNTRY, INDUSTRY
HAVING INDUSTRY IS NOT NULL
AND COUNTRY IS NOT NULL
--HAVING AVG(RATING) > 0.1 -- SO NULL VALUES ARE EXCLUDED
ORDER BY NUM_JOBS_IND DESC;

--AMOUNT OF JOBS PER STATE AND INDUSTRY
SELECT COUNTRY, STATE, INDUSTRY, COUNT(*) AS NUM_JOBS_STATE_IND
FROM JOBS_ALL 
GROUP BY COUNTRY, STATE, INDUSTRY
HAVING STATE IS NOT NULL
AND INDUSTRY IS NOT NULL
--HAVING AVG(RATING) > 0.1 -- SO NULL VALUES ARE EXCLUDED
ORDER BY NUM_JOBS_STATE_IND DESC;

--CONCLUSION
--CANADA: STATES ON AND BC POSSESS THE BIGGEST AMOUNT OF OFFERS FOR DATA ANALYST JOBS;
--IN PARTICULAR, TORONTO, VANCOUVER AND CALGARY ARE THE LEADERS IN THIS CHARACTERISTIC
--IN GENERAL, 'Technology, Information and Internet' AND 'Hospitals and Health Care' ARE THE MOST POPULAR INDUSTRIES, REGARDING AMOUNT OF JOBS WITHIN THEM
--STATE ONTARIO IS OBVIOUS LEADER, HAVING THE MOST POSTING IN THE MOST POPULAR INDUSTRIES ALREADY MENTIONED TOGETHER WITH 'Software Development' SECTOR

--USA: STATES CA AND TX HAVE THE BIGGEST LISTINGS OF DATA ANALYST JOBS;
--IN PARTICULAR, NY CITY, CHICAGO AND LA ARE THE LEADERS IN THIS CHARACTERISTIC
--IN TOTAL, 'IT SERVICES AND IT CONSULTING' AND 'STAFFING AND RECRUITING' ARE THE MOST POPULAR INDUSTRIES, REGARDING AMOUNT OF JOBS WITHIN THEM
--DATA ANALYST JOBS IN THESE INDUSTRIES ARE OFFERED IN TX AND CA STATES THE MOST


-----------------------------------------------------------------------------------------------------------------------------------------------------------------------


--AMOUNT AND PERCENTAGE OF REMOTE JOBS IN THE USA 
SELECT COUNTRY, COUNT(*) AS NUM_REMOTE_JOBS, ROUND(CAST(COUNT(*) AS FLOAT)/
  (SELECT COUNT(*)
  FROM JOBS_ALL
  WHERE COUNTRY = 'USA'),1)*100 AS PERCENT_OF_REMOTE_JOBS
  FROM JOBS_ALL
  GROUP BY COUNTRY, REMOTE
  HAVING COUNTRY = 'USA'
  AND REMOTE = 'yes';
  
--AMOUNT AND PERCENTAGE OF REMOTE JOBS IN CANADA
SELECT COUNTRY, COUNT(*) AS NUM_REMOTE_JOBS, ROUND(CAST(COUNT(*) AS FLOAT)/
  (SELECT COUNT(*)
  FROM JOBS_ALL
  WHERE COUNTRY = 'Canada'),1)*100 AS PERCENT_OF_REMOTE_JOBS
  FROM JOBS_ALL
  GROUP BY COUNTRY, REMOTE
  HAVING COUNTRY = 'Canada'
  AND REMOTE = 'yes';
  
 --AMOUNT AND PERCENTAGE OF PART-TIME JOBS IN THE USA 
SELECT COUNTRY, COUNT(*) AS NUM_REMOTE_JOBS, ROUND(CAST(COUNT(*) AS FLOAT)/
  (SELECT COUNT(*)
  FROM JOBS_ALL
  WHERE COUNTRY = 'USA'),1)*100 AS PERCENT_OF_PART_JOBS
  FROM JOBS_ALL
  GROUP BY COUNTRY, EMP_TYPE
  HAVING COUNTRY = 'USA'
  AND EMP_TYPE = 'Part-time';
  
 --AMOUNT AND PERCENTAGE OF PART-TIME JOBS IN THE CANADA 
SELECT COUNTRY, COUNT(*) AS NUM_PART_JOBS, ROUND(CAST(COUNT(*) AS FLOAT)/
  (SELECT COUNT(*)
  FROM JOBS_ALL
  WHERE COUNTRY = 'Canada'),1)*100 AS PERCENT_OF_PART_JOBS
  FROM JOBS_ALL
  GROUP BY COUNTRY, EMP_TYPE
  HAVING COUNTRY = 'Canada'
  AND EMP_TYPE = 'Part-time';

--CONCLUSION
--CANADA: THE FRACTION OF JOBS CAN BE WORKED ON REMOTELY IS 17% OF TOTAL AMOUNT 

--USA: THE FRACTION OF JOBS CAN BE WORKED ON REMOTELY IS 30% OF TOTAL AMOUNT, 13% MORE THAN IN CANADA  

--ANY OF COUNTRIES HAS PART-TIME DATA ANALYST'S JOBS' LISTINGS OR THIS NUMBER TOO SMALL TO BE CONSIDERED


-----------------------------------------------------------------------------------------------------------------------------------------------------------------------


--SALARY INFO PER STATE IN CANADA
SELECT COUNTRY, STATE, AVG(MIN_SALARY) AS AVG_MIN_SALARY_STATE_CAN, AVG(MAX_SALARY) AS AVG_MAX_SALARY_STATE_CAN
  FROM JOBS_ALL
  GROUP BY COUNTRY, STATE
  HAVING STATE IS NOT NULL AND COUNTRY = 'Canada' AND AVG(MIN_SALARY) IS NOT NULL
  ORDER BY AVG_MIN_SALARY_STATE_CAN DESC;

--SALARY INFO PER STATE IN THE USA
SELECT COUNTRY, STATE, AVG(MIN_SALARY) AS AVG_MIN_SALARY_STATE_US, AVG(MAX_SALARY) AS AVG_MAX_SALARY_STATE_US
  FROM JOBS_ALL
  GROUP BY COUNTRY, STATE
  HAVING STATE IS NOT NULL AND COUNTRY = 'USA' AND AVG(MIN_SALARY) IS NOT NULL
  ORDER BY AVG_MIN_SALARY_STATE_US DESC;
  
--SALARY INFO PER CITY IN CANADA
SELECT COUNTRY, CITY, AVG(MIN_SALARY) AS AVG_MIN_SALARY_CITY_CAN, AVG(MAX_SALARY) AS AVG_MAX_SALARY_CITY_CAN
  FROM JOBS_ALL
  GROUP BY COUNTRY, CITY
  HAVING CITY IS NOT NULL 
  AND COUNTRY = 'Canada' 
  AND AVG(MIN_SALARY) IS NOT NULL
  ORDER BY AVG_MIN_SALARY_CITY_CAN DESC;

--SALARY INFO PER CITY IN THE USA
SELECT COUNTRY, CITY, AVG(MIN_SALARY) AS AVG_MIN_SALARY_CITY_US, AVG(MAX_SALARY) AS AVG_MAX_SALARY_CITY_US
  FROM JOBS_ALL
  GROUP BY COUNTRY, CITY
  HAVING CITY IS NOT NULL 
  AND COUNTRY = 'USA' 
  AND AVG(MIN_SALARY) IS NOT NULL
  ORDER BY AVG_MIN_SALARY_CITY_US DESC;


--SALARY INFO FOR REMOTE JOBS IN BOTH COUNTRIES
SELECT COUNTRY, AVG(MIN_SALARY) AS AVG_MIN_SALARY_REMOTE, AVG(MAX_SALARY) AS AVG_MAX_SALARY_REMOTE
  FROM JOBS_ALL
  GROUP BY COUNTRY, REMOTE
  HAVING REMOTE = 'yes' 
  AND AVG(MIN_SALARY) IS NOT NULL
  ORDER BY AVG_MIN_SALARY_REMOTE DESC;
  
--SALARY INFO FOR JOBS IN BOTH COUNTRIES PER INDUSTRY
SELECT COUNTRY, INDUSTRY, AVG(MIN_SALARY) AS AVG_MIN_SALARY_IND, AVG(MAX_SALARY) AS AVG_MAX_SALARY_IND
  FROM JOBS_ALL
  GROUP BY COUNTRY, INDUSTRY
  HAVING AVG(MIN_SALARY) IS NOT NULL
  ORDER BY AVG_MIN_SALARY_IND DESC;

--CONCLUSION
--USA: STATES MS AND NC OFFER THE MOST COMPETITIVE SALARIES
--ON THIS REGARD TOP CITIES ARE WASHINGTON DC, JACKSON AND JERSEY CITY
--AVERAGE MINIMAL AND MAXIMAL SALARY ON REMOTE JOBS IN THE USA IS 78000 AND 97700 RESPECTIVELY
--HIGHEST AVERAGE MINIMAL SALARIES ARE IN 'Financial Services', 'Biotechnology Research', 'IT Services and IT Consulting' INDUSTRIES


--CANADA: STATES QUEBEC AND ALBERTA  ARE THE TOP ONES, CONSIDERING AVERAGE SALARIES FOR DATA ANALYSTS
--ON THIS REGARD TOP CITIES ARE OAKVILLE, MONTREAL, REGINA
--AVERAGE MINIMAL AND MAXIMAL SALARY ON REMOTE JOBS IN CANADA IS 48800 AND 63700 RESPECTIVELY
--HIGHEST AVERAGE MINIMAL SALARIES ARE IN 'Banking and Financial Services', 'Human Resources Services', '	Technology, Information and Internet' INDUSTRIES


-----------------------------------------------------------------------------------------------------------------------------------------------------------------------


--STATISTICS PER COUNTRY AND SENIORITY LEVEL 
SELECT JOB_LEVEL, COUNTRY, STATE, COUNT(*) AS NUM_SEN_LEVEL_JOBS
FROM JOBS_ALL 
GROUP BY JOB_LEVEL, COUNTRY, STATE
HAVING JOB_LEVEL IS NOT NULL
ORDER BY NUM_SEN_LEVEL_JOBS DESC;

--AMOUNT OF REMOTE JOBS, PER STATE AND SENIORITY LEVEL 
SELECT JOB_LEVEL, COUNTRY, STATE, COUNT(*) AS NUM_SEN_LEVEL_JOBS, 
       (SELECT COUNT(*) FROM JOBS_ALL WHERE REMOTE = 'yes') AS NUM_SEN_LEVEL_REMOTE_JOBS
FROM JOBS_ALL 
GROUP BY JOB_LEVEL, REMOTE, COUNTRY, STATE
HAVING JOB_LEVEL IS NOT NULL
AND STATE IS NOT NULL
AND REMOTE = 'yes'
ORDER BY NUM_SEN_LEVEL_JOBS DESC;

--SALARY INFO PER SENIORITY LEVEL IN BOTH COUNTRIES
SELECT JOB_LEVEL, COUNTRY, AVG(MIN_SALARY) AS AVG_MIN_SALARY_SENIOR, AVG(MAX_SALARY) AS AVG_MAX_SALARY_SENIOR
FROM JOBS_ALL
GROUP BY JOB_LEVEL, COUNTRY
HAVING JOB_LEVEL IS NOT NULL  
AND AVG(MIN_SALARY) IS NOT NULL
ORDER BY AVG_MIN_SALARY_SENIOR DESC;

--CONCLUSION
--IN BOTH COUNTRIES ENTRY LEVEL AND MID-SENIOR LEVEL JOBS PREVAIL
--IN BOTH REMOTE AND IN-OFFICE CATEGORIES
--STATE ONTARIO IS AN ABSOLUTE LEADER IN CANADA ON ALL SENIORITY LEVELS PRESENTED
--WITHIN THE US CA AND TX STATES SHARE THE FIRST PLACE REGARDING ENTRY LEVEL DATA ANALYST JOBS AVAILABLE 

--THE MAIN TREND NOTICEABLE IS THAT SALRIES IN THE US MORE COMPETITIVE IN EACH SENIORITY LEVEL: FROM ENTRY TO ASSOCIATE
